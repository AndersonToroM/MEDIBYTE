@{
    string Prefix = "Facturas";
    string UrlClick = Url.Action("Edit", "Facturas");
    string UrlNew = Url.Action("New", "Facturas");
    string ImprimirReporteCartera = Url.Action("ImprimirReporteCartera", "Facturas");
    string ImprimirCarteraGeneralReporte = Url.Action("ImprimirReporteCarteraGeneral", "Facturas");
    string ImprimirInformeCartera = Url.Action("ImprimirInformeCartera", "Facturas");
    string ImprimirInformeCarteraGeneral = Url.Action("ImprimirInformeCarteraGeneral", "Facturas");
    string ExportarSiigo = Url.Action("ExportarSiigo", "Facturas");

    var DataGridConfig = new DataGridConfiguration<Facturas>(Prefix)
    .OnClick(UrlClick, new { Id = "Id" })
    //.New(UrlNew,DApp.ActionViewSecurity(Context,UrlNew))
    .Exports(true, true).SetStorage()
    .AddButtons(new List<ButtonToolbar>
    {
            new ButtonToolbar
            {
                Action = $"{Prefix}MostrarModalImprimirCartera",
                Icon = "doc",
                Text = DApp.DefaultLanguage.GetResource("Facturas.ImprimirCartera"),
                LocateInMenu = ToolbarItemLocateInMenuMode.Always,
                Location = ToolbarItemLocation.Before
            },

            new ButtonToolbar
            {
                Action = $"{Prefix}ImprimirCarteraGeneral",
                Icon = "doc",
                Text = DApp.DefaultLanguage.GetResource("Facturas.ImprimirCarteraGeneral"),
                LocateInMenu = ToolbarItemLocateInMenuMode.Always,
                Location = ToolbarItemLocation.Before
            },

            new ButtonToolbar
            {
                Action = $"{Prefix}MostrarModalExportarSiigo",
                Icon = "xlsxfile",
                Text = DApp.DefaultLanguage.GetResource("Facturas.ExportarSiigo"),
                LocateInMenu = ToolbarItemLocateInMenuMode.Always,
                Location = ToolbarItemLocation.Before
            },

            new ButtonToolbar
            {
                Action = $"{Prefix}MostrarModalImprimirIormeCartera",
                Icon = "xlsxfile",
                Text = DApp.DefaultLanguage.GetResource("Facturas.ImprimirInformeCartera"),
                LocateInMenu = ToolbarItemLocateInMenuMode.Always,
                Location = ToolbarItemLocation.Before
            },
            
            new ButtonToolbar
            {
                Action = $"{Prefix}MostrarModalImprimirIormGeneralCartera",
                Icon = "xlsxfile",
                Text = DApp.DefaultLanguage.GetResource("Facturas.ImprimirInformeGeneralCartera"),
                LocateInMenu = ToolbarItemLocateInMenuMode.Always,
                Location = ToolbarItemLocation.Before
            }
    })

    .ToolbarTop(DApp.DefaultLanguage.GetResource("Facturas"), "mainPanel");
}

<script>
    
    function @(Prefix)MostrarModalImprimirCartera()
    {
        $("#@(Prefix)PopupImprimirCartera").dxPopup("instance").show();
    }
    
    function @(Prefix)ImprimirCartera() {

        $("#@(Prefix)Errores").html("");

        var entidadId = $("#@(Prefix)ReporteEntidadId").dxSelectBox("instance").option("value");

        if (entidadId == 0 || entidadId == "" || entidadId == null) {
            DevExpress.ui.notify("Error: La entidad es obligatoria.", "error", 4000);
            return false;
        }

        showLoadIndicator();
        $("#@(Prefix)PopupImprimirCartera").dxPopup("instance").hide();
        $.ajax({
            url: "@ImprimirReporteCartera",
              data: { entidadId: entidadId,  },
            type: 'GET',
            success: function (data) {
                $("#VisorReporteria").dxPopup("instance").show();
                $("#ContenidoReporte").html(data);
                hideLoadIndicator();
            },
            error: function (xhr) {
                console.log(xhr);
                hideLoadIndicator();
                DevExpress.ui.notify("Error: " + xhr.responseText, "error", 4000);
            }
        });
    }

    function @(Prefix)ImprimirCarteraGeneral() {

        $("#@(Prefix)Errores").html("");


        showLoadIndicator();
        $("#@(Prefix)PopupImprimirCarteraGeneral").dxPopup("instance").hide();
        $.ajax({
            url: "@ImprimirCarteraGeneralReporte",

            type: 'GET',
            success: function (data) {
                $("#VisorReporteria").dxPopup("instance").show();
                $("#ContenidoReporte").html(data);
                hideLoadIndicator();
            },
            error: function (xhr) {
                console.log(xhr);
                hideLoadIndicator();
                DevExpress.ui.notify("Error: " + xhr.responseText, "error", 4000);
               }
        });
    }
    
    function @(Prefix)MostrarModalExportarSiigo() 
    {
        $("#@(Prefix)PopupExportarSiigo").dxPopup("instance").show();
    }

    
    function @(Prefix)ExportarSiigo() {

        $("#@(Prefix)Errores").html("");

        var fechaDesde = moment($("#@(Prefix)ExportarSiigoFechaDesde").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");
        var fechaHasta = moment($("#@(Prefix)ExportarSiigoFechaHasta").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");;

         DescargarArchivo(
            "@Url.Action("ExportarSiigo", Prefix)",
                undefined,
                { fechaDesde: fechaDesde, fechaHasta: fechaHasta }
         );
    }

    function @(Prefix)MostrarModalImprimirIormeCartera()
    {
        $("#@(Prefix)PopupImprimirInformeCartera").dxPopup("instance").show();
    }

    function @(Prefix)ImprimirInformeCartera() {

        $("#@(Prefix)Errores").html("");

        var entidadId = $("#@(Prefix)ReporteEntidadId").dxSelectBox("instance").option("value");
        var fechaDesde = moment($("#@(Prefix)ReporteFechaDesde").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");
        var fechaHasta = moment($("#@(Prefix)ReporteFechaHasta").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");;

         DescargarArchivo(
                "@Url.Action("XLSXInformeCartera", Prefix)",
                undefined,
                { entidadId: entidadId, fechaDesde: fechaDesde, fechaHasta: fechaHasta }
         );
    }

    function @(Prefix)MostrarModalImprimirIormGeneralCartera()
    {
        $("#@(Prefix)PopupImprimirInformeGeneralCartera").dxPopup("instance").show();
    }

    function @(Prefix)ImprimirInformeGeneralCartera() {

        $("#@(Prefix)Errores").html("");

        var fechaDesde = moment($("#@(Prefix)ReporteGeneralFechaDesde").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");
        var fechaHasta = moment($("#@(Prefix)ReporteGeneralFechaHasta").dxDateBox("instance").option("value")).format("YYYY-MM-DDTHH:mm:ss");;

         DescargarArchivo(
            "@Url.Action("ImprimirInformeGeneralCartera", Prefix)",
                undefined,
                { fechaDesde: fechaDesde, fechaHasta: fechaHasta }
         );
    }

</script>


<div class="box-body table-responsive no-padding">
    @(Html.DControls().DataGridSimple<Facturas>(DataGridConfig)
        .ID("FacturasDataGrid")
        .DataSource(d => d.Mvc().LoadMethod("POST").Controller("Facturas").LoadAction("Get").Key("Id"))
        .RemoteOperations(true)
        .Columns(columns =>
         {
             columns.AddFor(m => m.Entidades.Nombre).Caption(DApp.DefaultLanguage.GetResource("Facturas.AdquirienteJuridico"));
             columns.AddFor(m => m.Pacientes.NombreCompleto).Caption(DApp.DefaultLanguage.GetResource("Facturas.AdquirienteNatural"));
             columns.AddFor(m => m.Sedes.Nombre).Caption(DApp.DefaultLanguage.GetResource("Facturas.Sede"));

             columns.AddFor(m => m.Documentos.Prefijo);
             columns.AddFor(m => m.NroConsecutivo);
             columns.AddFor(m => m.Fecha).SortOrder(SortOrder.Desc);

             columns.AddFor(m => m.ValorSubtotal);
             columns.AddFor(m => m.ValorCopagoCuotaModeradora);
             columns.AddFor(m => m.ValorTotal);
             columns.AddFor(m => m.Saldo);
             columns.AddFor(m => m.Estados.Nombre);
             columns.AddFor(m => m.TieneNotas);
             columns.AddFor(m => m.DIANResponse);
         })
)
</div>
<div class="row">
    <div class="col-md-12">
        @(Html.DControls().Popup()
            .ID($"{Prefix}PopupImprimirCartera")
            .Width(800)
            .Height(200)
            .ShowTitle(true)
            .Title(DApp.DefaultLanguage.GetResource("Facturas.ImprimirCartera"))
            .Visible(false)
            .DragEnabled(false)
            .CloseOnOutsideClick(false)
            .ContentTemplate(new TemplateName($"{Prefix}TemplateImprimirCartera"))
        )

        @using (Html.DevExtreme().NamedTemplate($"{Prefix}TemplateImprimirCartera"))
        {
            <div id="@(Prefix)Errores" class="text-danger text-sm-left"></div>
            <div class="row">
                <div class="form-group col-md-12">
                    <label for="@($"{Prefix}ReporteSedeId")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteEntidadId"):</label>
                    @(Html.DControls().SelectBox()
                        .ID($"{Prefix}ReporteEntidadId").InputAttr("class", "form-control")
                        .DataSource(d => d.Mvc().LoadMethod("POST").Controller(Prefix).LoadAction("GetEntidadesId").Key("Id"))
                        .DataSourceOptions(o => o.Paginate(true).PageSize(50))
                        .ValueExpr("Id").DisplayExpr("NitYNombre").SearchExpr("NumeroIdentificacion", "Nombre")
                        .SearchEnabled(true).ShowClearButton(true)
                    )
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <button class="btn btn-dark btn" id="@(Prefix)ButtonAccept" onclick="@(Prefix)ImprimirCartera()">IMPRIMIR</button>
            </div>
        }
    </div>
</div>



<div class="row">
    <div class="col-md-12">
        @(Html.DControls().Popup()
            .ID($"{Prefix}PopupImprimirCarteraGeneral")
            .Width(400)
            .Height(150)
            .ShowTitle(true)
            .Title(DApp.DefaultLanguage.GetResource("Facturas.ImprimirCarteraGeneral"))
            .Visible(false)
            .DragEnabled(false)
            .CloseOnOutsideClick(false)
            .ContentTemplate(new TemplateName($"{Prefix}TemplateImprimirCarteraGeneral"))
        )

        @using (Html.DevExtreme().NamedTemplate($"{Prefix}TemplateImprimirCarteraGeneral"))
        {
            <div id="@(Prefix)Errores" class="text-danger text-sm-left"></div>
            <div class="row">
                <div class="form-group col-md-12">
                    <label for="@($"{Prefix}ReporteSedeId")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteEntidadId"):</label>
                    @(Html.DControls().SelectBox()
                        .ID($"{Prefix}ReporteEntidadId").InputAttr("class", "form-control")
                        .DataSource(d => d.Mvc().LoadMethod("POST").Controller(Prefix).LoadAction("GetEntidadesId").Key("Id"))
                        .DataSourceOptions(o => o.Paginate(true).PageSize(50))
                        .ValueExpr("Id").DisplayExpr("NitYNombre").SearchExpr("NumeroIdentificacion", "Nombre")
                        .SearchEnabled(true).ShowClearButton(true)
                    )
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <button class="btn btn-dark btn" id="@(Prefix)ButtonAccept" onclick="@(Prefix)ImprimirCarteraGeneral()">IMPRIMIR</button>
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        @(Html.DControls().Popup()
            .ID($"{Prefix}PopupImprimirInformeCartera")
            .Width(800)
            .Height(280)
            .ShowTitle(true)
            .Title(DApp.DefaultLanguage.GetResource("Facturas.ImprimirInformeCartera"))
            .Visible(false)
            .DragEnabled(false)
            .CloseOnOutsideClick(false)
            .ContentTemplate(new TemplateName($"{Prefix}TemplateImprimirInformeCartera"))
            )

        @using (Html.DevExtreme().NamedTemplate($"{Prefix}TemplateImprimirInformeCartera"))
        {
            <div id="@(Prefix)Errores" class="text-danger text-sm-left"></div>
            <div class="row">
                <div class="form-group col-md-12">
                    <label for="@($"{Prefix}ReporteSedeId")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteEntidadId"):</label>
                    @(Html.DControls().SelectBox()
                        .ID($"{Prefix}ReporteEntidadId").InputAttr("class", "form-control")
                        .DataSource(d => d.Mvc().LoadMethod("POST").Controller(Prefix).LoadAction("GetEntidadesId").Key("Id"))
                        .DataSourceOptions(o => o.Paginate(true).PageSize(50))
                        .ValueExpr("Id").DisplayExpr("NitYNombre").SearchExpr("NumeroIdentificacion", "Nombre")
                        .SearchEnabled(true).ShowClearButton(true)
                        )
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ReporteFechaDesde")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteFechaDesde"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ReporteFechaDesde").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ReporteFechaHasta")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteFechaHasta"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ReporteFechaHasta").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <button class="btn btn-dark btn" id="@(Prefix)ButtonAccept" onclick="@(Prefix)ImprimirInformeCartera()">DESCARGAR</button>
            </div>
        }

       </div>
</div>
<div class="row">
    <div class="col-md-12">
                @(Html.DControls().Popup()
                    .ID($"{Prefix}PopupImprimirInformeGeneralCartera")
                    .Width(550)
                    .Height(200)
                    .ShowTitle(true)
                    .Title(DApp.DefaultLanguage.GetResource("Facturas.ImprimirInformeGeneralCartera"))
                    .Visible(false)
                    .DragEnabled(false)
                    .CloseOnOutsideClick(false)
                    .ContentTemplate(new TemplateName($"{Prefix}TemplateImprimirInformeGeneralCartera"))
                    )

        @using (Html.DevExtreme().NamedTemplate($"{Prefix}TemplateImprimirInformeGeneralCartera"))
        {
            <div id="@(Prefix)Errores" class="text-danger text-sm-left"></div>
            
            <div class="row">
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ReporteGeneralFechaDesde")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteGeneralFechaDesde"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ReporteGeneralFechaDesde").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ReporteGeneralFechaHasta")">@DApp.DefaultLanguage.GetResource("Facturas.ReporteGeneralFechaHasta"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ReporteGeneralFechaHasta").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <button class="btn btn-dark btn" id="@(Prefix)ButtonAccept" onclick="@(Prefix)ImprimirInformeGeneralCartera()">DESCARGAR</button>
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        @(Html.DControls().Popup()
            .ID($"{Prefix}PopupExportarSiigo")
            .Width(550)
            .Height(200)
            .ShowTitle(true)
            .Title(DApp.DefaultLanguage.GetResource("Facturas.ExportarSiigo"))
            .Visible(false)
            .DragEnabled(false)
            .CloseOnOutsideClick(false)
            .ContentTemplate(new TemplateName($"{Prefix}TemplateExportarSiigo"))
            )

        @using (Html.DevExtreme().NamedTemplate($"{Prefix}TemplateExportarSiigo"))
        {
            <div id="@(Prefix)Errores" class="text-danger text-sm-left"></div>

            <div class="row">
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ExportarSiigoFechaDesde")">@DApp.DefaultLanguage.GetResource("Facturas.ExportarSiigoFechaDesde"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ExportarSiigoFechaDesde").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
                <div class="form-group col-md-6">
                    <label for="@($"{Prefix}ExportarSiigoFechaHasta")">@DApp.DefaultLanguage.GetResource("Facturas.ExportarSiigoFechaHasta"):</label>
                    @(Html.DControls().DateBox().Value(DateTime.Now)
                        .ID($"{Prefix}ExportarSiigoFechaHasta").InputAttr("class", "form-control")
                        .DisplayFormat(DApp.DefaultLanguage.DateFormat).Placeholder(DateTime.Now.ToString(DApp.DefaultLanguage.DateFormat)).ShowClearButton(true).UseMaskBehavior(true)
                        )
                </div>
            </div>

            <div class="row d-flex justify-content-center">
                <button class="btn btn-dark btn" id="@(Prefix)ButtonAccept" onclick="@(Prefix)ExportarSiigo()">DESCARGAR</button>
            </div>
        }
    </div>
</div>